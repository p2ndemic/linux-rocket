# =============================================
# Исправление проблем с Avahi. Если вы не используете Avahi, который в основном используется для локальных сетевых служб (принтеры и т.д). То вы можете просто отключить эту службу
# =============================================
# От avahi зависят некоторые пакеты, поэтому зачастую этот мусорный сервис устанавливается как зависимость приложений, таких как например: ├─ pipewire-pulse и ├─ libcups
# Проверка зависимостей: pactree -r avahi
# =============================================

# =============================================
# Зачастую при работе с Systemd-Resolved вы будете получать следующую ошибку:
# avahi-daemon[732]: *** WARNING: Detected another IPv4 mDNS stack running on this host. This makes mDNS unreliable and is thus not recommended. ***
# =============================================
# Исправление:

# 1. Systemd-Resolved. Найди строку MulticastDNS= и измени её значение на no. Если такой строки нет, добавь её в секцию [Resolve]:
# Готовый конфиг: https://github.com/p2ndemic/dotfiles/blob/main/etc/systemd/resolved.conf.d/99-custom-dns.conf.bak

sudo nano /etc/systemd/resolved.conf
[Resolve]
MulticastDNS=no

# 2. Отключение сервисов Avahi:
sudo systemctl disable --now avahi-daemon.service avahi-daemon.socket

# 3. Замаскировать сервис:
# Это предотвратит его запуск другими службами, которые могут от него зависеть (например, cups-browsed для поиска сетевых принтеров).
sudo systemctl mask avahi-daemon.service avahi-daemon.socket

# Проверка работы Avahi:
systemctl status avahi-daemon
